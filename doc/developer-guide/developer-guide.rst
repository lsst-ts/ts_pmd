.. _Developer_Guide:

###################
PMD Developer Guide
###################


.. _Dependencies:

Dependencies
============


* `SAL <https://ts-sal.lsst.io>`_ - v7.x
* ts_salobj - v7.x

.. _API:

PMD API
=======

The content in this section is autogenerated from docstrings.

.. automodapi:: lsst.ts.pmd
    :no-main-docstr:
    :no-inheritance-diagram:


.. _Build:

Build and Test
==============

EUPS
----

.. prompt::

    pip install pyserial
    setup -kr .
    scons --clean
    scons

PIP
---

.. prompt::

    pip install -e .
    scons --clean
    scons 


.. _Usage:

Usage
=====

Mitutoyo
--------
The Mitutoyo hub is a black box with several different ports on the front of it.

* USB Type A port
* RS-232 port

The code for this CSC only works with the RS-232 port as the USB type A uses a different communication library.
You will need a USB to RS-232 adapter cable in order to communicate with this hub.

The back of the hub has 8 different ports for power and RS-232 connections for connecting to the devices.

Communicating with the hub is fairly simple, it only accepts a handful of commands.

.. list-table::
    :header-rows: 1

    * - Command
      - Action
    * - /n where n = 1-8
      - Value from nth device
    * - SPC
      - Configure the Hub

The hub has a number of options to configure the performance of various aspects of the devices connected to a hub.
You can communicate with the device using a terminal emulator like minicom or pyserial's built in tool ``python -m serial.tools.miniterm``
The main options to change are the ``D0X`` where X is the port of the device.
This option mainly changes how the device reading is triggered, you want to make sure that it is set to individual as other options do not function with this code.
The other option to change is under ``SPL`` which controls the baud rate setting for the hub, by default it may be 4800 and it should be 9200 as that is what the code assumes.
Send the ``EX`` command in order to exit with your changes saved to the hub.

.. _Simulator:

Simulator
=========

No simulator has been written for this device.


.. _Firmware:

Updating Firmware of the PMD
============================

Firmware is not updatable by the end user.



.. _Documentation:

Building the Documentation
==========================

.. prompt::

    package-docs build .
    xdg-open _build/html/index.html # on linux
    open _build/html/index.html # on MacOS

.. _Contributing:

Contributing
============

Code and documentation contributions utilize pull-requests on github.
Feature requests can be made by filing a Jira ticket with the `ts_pmd` label.
In all cases, reaching out to the :ref:`contacts for this CSC <ts_xml:index:master-csc-table:PMD>` is recommended.

